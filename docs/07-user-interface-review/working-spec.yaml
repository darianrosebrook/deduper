id: UI-REV-001
title: 'User Interface for Duplicate Review and Management'
risk_tier: 3
scope:
  in:
    - 'SwiftUI screens for onboarding, permissions, scan status, groups list, group detail, merge plan, cleanup summary'
    - 'Component architecture with primitives → compounds → composers → assemblies'
    - 'Design system integration with token-based styling and accessibility contracts'
    - 'Preview systems with QuickLook integration and thumbnail caching'
    - 'Evidence panel showing duplicate signals, thresholds, and confidence metrics'
    - 'Merge planner with deterministic policy explanation and per-field overrides'
    - 'History and undo system with restore from Trash functionality'
  out:
    - 'Backend API contracts (handled by separate service layer)'
    - 'File system operations (handled by core engine)'
    - 'Metadata persistence (handled by persistence layer)'
    - 'Duplicate detection algorithms (handled by core engine)'
invariants:
  - 'UI remains responsive during long-running scans with virtualized lists'
  - 'All interactive components maintain accessibility standards (WCAG AA)'
  - 'Design tokens used consistently across all components for theming support'
  - 'Component contracts define complete API, states, and accessibility behavior'
  - 'Error states provide clear guidance and recovery paths'
  - 'Time-to-first-group < 3s on test dataset with scroll performance > 60fps'
  - 'All destructive actions require confirmation with clear preview'
  - 'Keyboard navigation fully supported with documented shortcuts'
acceptance:
  - id: A1
    given: 'User has duplicate groups to review'
    when: 'User opens groups list'
    then: 'Groups render incrementally with thumbnails, counts, confidence meters, and signal badges'
  - id: A2
    given: 'User selects a duplicate group'
    when: 'User opens group detail view'
    then: 'Side-by-side comparison shows with keeper selection, metadata diff, and evidence panel'
  - id: A3
    given: 'User configures merge plan'
    when: 'User confirms merge action'
    then: 'Merge executes deterministically with dry-run option and full undo support'
  - id: A4
    given: 'User encounters permission error'
    when: 'User sees error state'
    then: 'Clear guidance provided with actionable steps to resolve permissions'
  - id: A5
    given: 'User with accessibility needs'
    when: 'User navigates with VoiceOver or keyboard'
    then: 'Full accessibility support with proper labeling and navigation paths'
non_functional:
  a11y:
    - 'WCAG AA compliance for all components'
    - 'Full keyboard navigation with documented shortcuts'
    - 'VoiceOver labels and contextual descriptions'
    - 'High contrast support using semantic color tokens'
    - 'Focus management with visible focus indicators'
  perf:
    api_p95_ms: 100
    lcp_ms: 3000
    tbt_ms: 500
  security:
    - 'No sensitive data exposed in UI components'
    - 'Read-only operation until explicit user confirmation'
    - 'Permission validation before destructive operations'
    - 'Input sanitization for user-provided metadata'
contracts:
  - type: openapi
    path: 'contracts/ui-components.yaml'
observability:
  logs:
    - 'ui.render.timing for component render duration'
    - 'ui.interaction.action for user actions'
    - 'ui.evidence.confidence for duplicate confidence composition'
    - 'ui.accessibility.violation for a11y issues'
  metrics:
    - 'ui.groups.rendered_count'
    - 'ui.actions.merge_success_count'
    - 'ui.accessibility.violation_rate'
    - 'ui.performance.scroll_fps'
  traces:
    - 'ui.group_detail_view span with group_id and interaction_path'
    - 'ui.merge_action span with keeper_id and removed_items_count'
    - 'ui.evidence_panel span with signal_types and confidence_values'
migrations: []
rollback:
  - 'Feature flag UI_DUPLICATE_REVIEW=false to disable new UI'
  - 'Fallback to basic list view if component contracts fail validation'
