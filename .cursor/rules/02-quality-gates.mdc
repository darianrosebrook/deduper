---
description: Quality gates and execution discipline
globs:
alwaysApply: true
---

# Quality Gates

## Execution

- Run unit tests and lints after any major change; iterate until green.
- If the project defines an engine, confirm Node version via console before running scripts.
- `.env` files exist; do **not** attempt to cat protected dotfiles. Use framework tooling or documented env loaders.

## Commits

- `--no-verify` is **not allowed**. If hooks fail, **fix the cause** or split work into smaller audited commits.
- Commit subjects: **what + why** in one sentence. Bodies for context only when needed.

## TODOs & Placeholders

Tag placeholders explicitly in code:

- `// TODO: ...` (critical, must block if reached)
- `// PLACEHOLDER: ...` (non-critical placeholder, warn)
- `// MOCK DATA: ...` (remove before release)

**Critical TODOs**: throw at execution site with clear message.

**Detection**: Use `python scripts/v3/analysis/todo_analyzer.py --staged-only --min-confidence 0.7 --ci-mode` to verify no hidden TODOs in production code.

## Naming Convention Enforcement

**Banned naming patterns** (block commits if found):
- `enhanced | unified | simplified | better | new | next | final | copy | revamp | improved` (case-insensitive)

**Why these patterns are problematic:**
- Create confusion about which version is current
- Lead to import errors and maintenance overhead  
- Indicate incomplete refactoring or unclear requirements
- Violate single source of truth principle

**Automated Detection:**
```bash
# Check for banned naming patterns in filenames and symbols
rg -n --no-ignore -g '!node_modules' '(?i)(enhanced|unified|simplified|better|new|next|final|copy|revamp|improved).*\.(rs|ts|tsx|js|jsx|mjs|cjs|mts|cts|py|go|java|cpp|c|h)$'

# Check for banned patterns in symbol names
rg -n --no-ignore -g '!node_modules' '(?i)\b(enhanced|unified|simplified|better|new|next|final|copy|revamp|improved)\b'
```

**Enforcement Actions:**
1. **Block commits** with files containing banned patterns
2. **Require refactoring** to canonical names before merge
3. **Update all imports** to use canonical names
4. **Remove duplicate files** after merging functionality

### Implementation Completeness Verification

**Required Patterns:**
```typescript
// ✅ GOOD: Explicit placeholder with error
function getUserData(id: string) {
  // PLACEHOLDER: Real user data fetching not implemented
  throw new Error("PLACEHOLDER: getUserData not implemented");
}

// ✅ GOOD: Production-ready implementation
function getUserData(id: string) {
  return this.db.query('SELECT * FROM users WHERE id = $1', [id]);
}
```

**Forbidden Patterns:**
```typescript
// ❌ BAD: Silent stub implementation
function getUserData(id: string) {
  return { id, name: "Mock User" }; // No indication this is fake
}

// ❌ BAD: Console.log stub
function processOrder(order: Order) {
  console.log("Processing order:", order); // Not real implementation
  return { success: true };
}
```

**Automated Detection:**
```bash
# Check for incomplete implementations
rg -n "PLACEHOLDER|TODO|MOCK_DATA|FIXME|HACK" src/
rg -n "throw new Error.*not implemented" src/
rg -n "return.*mock|fake|dummy" src/
```

### Risk-Based Quality Gates

**Tier 1 (Critical Systems):**
- Coverage: 90%+ line, 95%+ branch
- Mutation Score: 70%+
- Review: Manual required
- Security Scan: Required

**Tier 2 (Standard Features):**
- Coverage: 80%+ line, 90%+ branch
- Mutation Score: 50%+
- Review: Optional
- Security Scan: Required

**Tier 3 (Low Risk):**
- Coverage: 70%+ line, 80%+ branch
- Mutation Score: 30%+
- Review: Optional
- Security Scan: Recommended

## Diagrams/Charts

- In Markdown, use **Mermaid** only. Ensure contrast (dark text on light, light on dark backgrounds).

## Acceptance

- `test`, `lint`, `typecheck` succeed.
- No TODOs executed at runtime.
- No style violations flagged by project linters.
- No banned naming patterns in filenames or symbols.
- All imports reference canonical names only.
