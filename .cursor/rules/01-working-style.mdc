---
description: Default agent behavior, edit style, and risk limits
globs:
alwaysApply: true
---

# Working Style & Risk Limits

## Intent

Prefer directly applying fixes over explaining. Explanations are secondary unless asked, or when a change is **risky** (see Risk Gate).

## Edit Principles

- **Small, bounded diffs.** Keep edits minimal, cohesive, and reviewable.
- **Edit existing modules over forking.** Prefer refactor + rename to duplication.
- **Preserve public behavior** unless the task explicitly requests behavioral change.

## Ask-First Triggers (Risk Gate)

Before editing, _ask with a Targeted Edit Plan_ if any are true:

- Changes cross package boundaries or public APIs.
- Requires deleting files or renaming public symbols.
- Introduces a new dependency or build tool.
- Affects security, persistence, auth, or infra.
- Exceeds change budget limits (see Scope Management).
- Triggers emergency waiver conditions (see Waiver System).

### Change Budget Enforcement

**Automatic Detection:**
- Files outside `scope.in` boundaries
- Exceeding `max_files` or `max_loc` limits
- High complexity changes (> 10 cyclomatic complexity)

**Emergency Override Conditions:**
- Security vulnerabilities with active exploitation
- Production system completely down
- Data corruption in progress
- Regulatory compliance deadline

**Waiver Requirements:**
- Root cause analysis
- Minimal fix description
- Risk assessment and mitigation plan
- Timeline for comprehensive solution

**Targeted Edit Plan (TEP)** must include:

- Scope (files, symbols), risks, rollback notes.
- Tests to run/update.
- Acceptance checks (what passing looks like).

## Diff Hygiene

- Keep each commit focused on one intent.
- Include brief rationale in the commit subject (â‰¤72 chars).
- Never bypass pre-commit hooks; `--no-verify` is **forbidden**.

## When to Explain

- On TEP prompts, on rejected edits, or when trade-offs are non-obvious.
- Keep explanations concise and adjacent to the diff.

## Acceptance (per PR)

- Tests + lints pass locally.
- No widened public API surface without TEP.
- No dead code or duplicate modules introduced.
